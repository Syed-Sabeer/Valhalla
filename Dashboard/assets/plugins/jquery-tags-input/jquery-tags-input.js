(function(d){var e=new Array;var f=new Array;d.fn.doAutosize=function(a){var m=d(this).data("minwidth"),n=d(this).data("maxwidth"),o="",p=d(this),q=d("#"+d(this).data("tester_id"));if(o===(o=p.val())){return}var r=o.replace(/&/g,"&").replace(/\s/g," ").replace(/</g,"<").replace(/>/g,">");q.html(r);var s=q.width(),t=s+a.comfortZone>=m?s+a.comfortZone:m,u=p.width(),v=t<u&&t>=m||t>m&&t<n;if(v){p.width(t)}};d.fn.resetAutosize=function(a){var j=d(this).data("minwidth")||a.minInputWidth||d(this).width(),k=d(this).data("maxwidth")||a.maxInputWidth||d(this).closest(".tagsinput").width()-a.inputPadding,l="",m=d(this),n=d("<tester/>").css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:m.css("fontSize"),fontFamily:m.css("fontFamily"),fontWeight:m.css("fontWeight"),letterSpacing:m.css("letterSpacing"),whiteSpace:"nowrap"}),o=d(this).attr("id")+"_autosize_tester";if(!d("#"+o).length>0){n.attr("id",o);n.appendTo("body")}m.data("minwidth",j);m.data("maxwidth",k);m.data("tester_id",o);m.css("width",j)};d.fn.addTag=function(a,b){b=jQuery.extend({focus:false,callback:true},b);this.each(function(){var c=d(this).attr("id");var k=d(this).val().split(e[c]);if(k[0]==""){k=new Array}a=jQuery.trim(a);if(b.unique){var l=d(k).tagExist(a);if(l==true){d("#"+c+"_tag").addClass("not_valid")}}else{var l=false}if(a!=""&&l!=true){d("<span>").addClass("tag").append(d("<span>").text(a).append("  "),d("<a>",{href:"#",title:"Removing tag",html:"<i class='fa fa-times'></i>"}).click(function(){return d("#"+c).removeTag(escape(a))})).insertBefore("#"+c+"_addTag");k.push(a);d("#"+c+"_tag").val("");if(b.focus){d("#"+c+"_tag").focus()}else{d("#"+c+"_tag").blur()}d.fn.tagsInput.updateTagsField(this,k);if(b.callback&&f[c]&&f[c]["onAddTag"]){var m=f[c]["onAddTag"];m.call(this,a)}if(f[c]&&f[c]["onChange"]){var n=k.length;var m=f[c]["onChange"];m.call(this,d(this),k[n-1])}}});return false};d.fn.removeTag=function(a){a=unescape(a);this.each(function(){var b=d(this).attr("id");var c=d(this).val().split(e[b]);d("#"+b+"_tagsinput .tag").remove();str="";for(i=0;i<c.length;i++){if(c[i]!=a){str=str+e[b]+c[i]}}d.fn.tagsInput.importTags(this,str);if(f[b]&&f[b]["onRemoveTag"]){var h=f[b]["onRemoveTag"];h.call(this,a)}});return false};d.fn.tagExist=function(a){return jQuery.inArray(a,d(this))>=0};d.fn.importTags=function(a){id=d(this).attr("id");d("#"+id+"_tagsinput .tag").remove();d.fn.tagsInput.importTags(this,a)};d.fn.tagsInput=function(a){var b=jQuery.extend({interactive:true,defaultText:"add a tag",minChars:0,width:"300px",height:"100px",autocomplete:{selectFirst:false},hide:true,delimiter:",",unique:true,removeWithBackspace:true,placeholderColor:"#666666",autosize:true,comfortZone:20,inputPadding:6*2},a);this.each(function(){if(b.hide){d(this).hide()}var c=d(this).attr("id");if(!c||e[d(this).attr("id")]){c=d(this).attr("id","tags"+(new Date).getTime()).attr("id")}var h=jQuery.extend({pid:c,real_input:"#"+c,holder:"#"+c+"_tagsinput",input_wrapper:"#"+c+"_addTag",fake_input:"#"+c+"_tag"},b);e[c]=h.delimiter;if(b.onAddTag||b.onRemoveTag||b.onChange){f[c]=new Array;f[c]["onAddTag"]=b.onAddTag;f[c]["onRemoveTag"]=b.onRemoveTag;f[c]["onChange"]=b.onChange}var j='<div id="'+c+'_tagsinput" class="tagsinput"><div id="'+c+'_addTag">';if(b.interactive){j=j+'<input id="'+c+'_tag" value="" data-default="'+b.defaultText+'" />'}j=j+'</div><div class="tags_clear"></div></div>';d(j).insertAfter(this);d(h.holder).css("width",b.width);d(h.holder).css("height",b.height);if(d(h.real_input).val()!=""){d.fn.tagsInput.importTags(d(h.real_input),d(h.real_input).val())}if(b.interactive){d(h.fake_input).val(d(h.fake_input).attr("data-default"));d(h.fake_input).css("color",b.placeholderColor);d(h.fake_input).resetAutosize(b);d(h.holder).bind("click",h,function(g){d(g.data.fake_input).focus()});d(h.fake_input).bind("focus",h,function(g){if(d(g.data.fake_input).val()==d(g.data.fake_input).attr("data-default")){d(g.data.fake_input).val("")}d(g.data.fake_input).css("color","#000000")});if(b.autocomplete_url!=undefined){autocomplete_options={source:b.autocomplete_url};for(attrname in b.autocomplete){autocomplete_options[attrname]=b.autocomplete[attrname]}if(jQuery.Autocompleter!==undefined){d(h.fake_input).autocomplete(b.autocomplete_url,b.autocomplete);d(h.fake_input).bind("result",h,function(g,k,l){if(k){d("#"+c).addTag(k[0]+"",{focus:true,unique:b.unique})}})}else{if(jQuery.ui.autocomplete!==undefined){d(h.fake_input).autocomplete(autocomplete_options);d(h.fake_input).bind("autocompleteselect",h,function(g,k){d(g.data.real_input).addTag(k.item.value,{focus:true,unique:b.unique});return false})}}}else{d(h.fake_input).bind("blur",h,function(g){var k=d(this).attr("data-default");if(d(g.data.fake_input).val()!=""&&d(g.data.fake_input).val()!=k){if(g.data.minChars<=d(g.data.fake_input).val().length&&(!g.data.maxChars||g.data.maxChars>=d(g.data.fake_input).val().length)){d(g.data.real_input).addTag(d(g.data.fake_input).val(),{focus:true,unique:b.unique})}}else{d(g.data.fake_input).val(d(g.data.fake_input).attr("data-default"));d(g.data.fake_input).css("color",b.placeholderColor)}return false})}d(h.fake_input).bind("keypress",h,function(g){if(g.which==g.data.delimiter.charCodeAt(0)||g.which==13){g.preventDefault();if(g.data.minChars<=d(g.data.fake_input).val().length&&(!g.data.maxChars||g.data.maxChars>=d(g.data.fake_input).val().length)){d(g.data.real_input).addTag(d(g.data.fake_input).val(),{focus:true,unique:b.unique})}d(g.data.fake_input).resetAutosize(b);return false}else{if(g.data.autosize){d(g.data.fake_input).doAutosize(b)}}});h.removeWithBackspace&&d(h.fake_input).bind("keydown",function(g){if(g.keyCode==8&&d(this).val()==""){g.preventDefault();var k=d(this).closest(".tagsinput").find(".tag:last").text();var l=d(this).attr("id").replace(/_tag$/,"");k=k.replace(/[\s]+x$/,"");d("#"+l).removeTag(escape(k));d(this).trigger("focus")}});d(h.fake_input).blur();if(h.unique){d(h.fake_input).keydown(function(g){if(g.keyCode==8||String.fromCharCode(g.which).match(/\w+|[áéíóúÁÉÍÓÚñÑ,/]+/)){d(this).removeClass("not_valid")}})}}});return this};d.fn.tagsInput.updateTagsField=function(a,b){var g=d(a).attr("id");d(a).val(b.join(e[g]))};d.fn.tagsInput.importTags=function(a,b){d(a).val("");var c=d(a).attr("id");var j=b.split(e[c]);for(i=0;i<j.length;i++){d(a).addTag(j[i],{focus:false,callback:false})}if(f[c]&&f[c]["onChange"]){var k=f[c]["onChange"];k.call(a,a,j[i])}}})(jQuery);